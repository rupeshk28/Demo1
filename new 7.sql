CREATE ALGORITHM=UNDEFINED DEFINER=root@localhost SQL SECURITY DEFINER VIEW paymentsdata AS with paymentcte as (select c.Id AS PaymentId,acc.BRANCH AS Location,acc.STATE AS STATE,acc.BRANCH_CODE AS BranchId,acc.BRANCH AS BranchName,orgpart.CustomId AS AgencyId,orgpart.FirstName AS AgencyName,collctor.PrimaryEMail AS AgentEmail,collctor.FirstName AS AgentName,collctor.CustomId AS AgentId,r.CustomId AS ReceiptNo,r.CustomId AS PhysicalReceiptNo,c.CollectionDate AS ReceiptDate,c.CollectionDate AS CollectionDate,acc.CustomId AS ReferenceNo,c.CustomerName AS CustomerName,acc.PRODUCT AS PRODUCT,acc.CUSTOMERID AS CUSTOMERID,acc.PRIMARY_CARD_NUMBER AS PRIMARY_CARD_NUMBER,c.amountBreakUp1 AS amountBreakUp1,c.amountBreakUp2 AS amountBreakUp2,c.amountBreakUp3 AS amountBreakUp3,c.amountBreakUp4 AS amountBreakUp4,c.amountBreakUp5 AS amountBreakUp5,c.amountBreakUp6 AS amountBreakUp6,'' AS PaymentTowards,cast(acc.CURRENT_BUCKET as char charset utf8mb4) AS CURRENTBUCKET,c.yOverdueAmount AS EMIAMT,c.yPenalInterest AS LatePaymentPenalty,c.yBounceCharges AS BounceCharges,'' AS Excess,'' AS IMD,'' AS ProcFee,'' AS Swap,'' AS EBCCharge,'' AS CollectionPickupCharge,c.yForeClosureAmount AS ForeclosureAmount,c.Amount AS TotalReceiptAmount,c.CollectionMode AS PaymentMode,chq.InstrumentDate AS InstrumentDate,chq.InstrumentNo AS InstrumentNo,c.Amount AS InstrumentAmount,chq.MICRCode AS MICRCode,c.yPANNo AS PANCardNo,batch.CustomId AS BatchID,batch.CreatedDate AS BatchIDCreatedDate,slip.CreatedDate AS DepositDate,batch.Amount AS BatchAmount,(case when (slip.Id = 1) then slip.Id else slip.CustomId end) AS ENCollectPayInSlipID,slip.CMSPayInSlipNo AS CMSPayInSlipID,slip.BankAccountNo AS DepositAccountNumber,slip.BankName AS DepositeBankName,slip.Amount AS DepositAmount,(case when ((payinsliplc.Discriminator is not null) and (payinsliplc.Discriminator <> '')) then payinsliplc.Discriminator when ((batchlc.Discriminator is not null) and (batchlc.Discriminator <> '')) then batchlc.Discriminator else lc.Discriminator end) AS PaymentStatus,acc.ProductGroup AS ProductGroup,'' AS MerchantReferenceNumber,'' AS MID,'' AS BankTransactionId,'' AS BankId,c.Amount AS Amount,'' AS StatusCode,'' AS CreatedDate,'' AS RRN,'' AS AuthCode,'' AS CardNumber,'' AS CardType,'' AS CardHolderName,'' AS MerchantId,'' AS MerchantTransactionId,'' AS BBPayPartnerAgentCode,'' AS BBPayPartnerAgentEmailId,'' AS BBPayPartnerAgentMobileNumber,'' AS BBPayPartnerBranchCode,'' AS BBPayBatchAckDate,acc.CITY AS CITY,collctor.FirstName AS AckingAgent,slip.BankName AS PayInSlipDepositBankName,cast(acc.BUCKET as char charset utf8mb4) AS BOMBucket,acc.NPA_STAGEID AS NPA_STAGEID,acc.Region AS Region,acc.AGREEMENTID AS AGREEMENTID,acc.CURRENT_POS AS CURRENT_POS,date_format(c.LastModifiedDate,'%Y-%m-%d %T') AS lastmodifieddate from ((((((((((collections c join receipts r on((c.ReceiptId = r.Id))) left join applicationuser collctor on((c.CollectorId = collctor.Id))) left join applicationorg orgpart on((collctor.AgencyId = orgpart.Id))) left join cheques chq on((c.ChequeId = chq.Id))) left join collectionbatches batch on((c.CollectionBatchId = batch.Id))) left join payinslips slip on((batch.PayInSlipId = slip.Id))) left join loanaccounts acc on((c.AccountId = acc.Id))) left join payinslipworkflowstate payinsliplc on((payinsliplc.Id = slip.PayInSlipWorkflowStateId))) left join collectionbatchworkflowstate batchlc on((batchlc.Id = batch.CollectionBatchWorkflowStateId))) join collectionworkflowstate lc on((lc.Id = c.CollectionWorkflowStateId)))) select p.PaymentId AS PaymentId,p.Location AS Location,p.STATE AS STATE,p.BranchId AS BranchId,p.BranchName AS BranchName,p.AgencyId AS AgencyId,p.AgencyName AS AgencyName,p.AgentEmail AS AgentEmail,p.AgentName AS AgentName,p.AgentId AS AgentId,p.ReceiptNo AS ReceiptNo,p.PhysicalReceiptNo AS PhysicalReceiptNo,p.ReceiptDate AS ReceiptDate,p.CollectionDate AS CollectionDate,p.ReferenceNo AS ReferenceNo,p.CustomerName AS CustomerName,p.PRODUCT AS PRODUCT,p.CUSTOMERID AS CUSTOMERID,p.PRIMARY_CARD_NUMBER AS PRIMARY_CARD_NUMBER,p.amountBreakUp1 AS amountBreakUp1,p.amountBreakUp2 AS amountBreakUp2,p.amountBreakUp3 AS amountBreakUp3,p.amountBreakUp4 AS amountBreakUp4,p.amountBreakUp5 AS amountBreakUp5,p.amountBreakUp6 AS amountBreakUp6,p.PaymentTowards AS PaymentTowards,cast(p.CURRENTBUCKET as char charset utf8mb4) AS CURRENTBUCKET,p.EMIAMT AS EMIAMT,p.LatePaymentPenalty AS LatePaymentPenalty,p.BounceCharges AS BounceCharges,p.Excess AS Excess,p.IMD AS IMD,p.ProcFee AS ProcFee,p.Swap AS Swap,p.EBCCharge AS EBCCharge,p.CollectionPickupCharge AS CollectionPickupCharge,p.ForeclosureAmount AS ForeclosureAmount,p.TotalReceiptAmount AS TotalReceiptAmount,p.PaymentMode AS PaymentMode,p.InstrumentDate AS InstrumentDate,p.InstrumentNo AS InstrumentNo,p.InstrumentAmount AS InstrumentAmount,p.MICRCode AS MICRCode,p.PANCardNo AS PANCardNo,p.BatchID AS BatchID,p.BatchIDCreatedDate AS BatchIDCreatedDate,p.DepositDate AS DepositDate,p.BatchAmount AS BatchAmount,p.ENCollectPayInSlipID AS ENCollectPayInSlipID,p.CMSPayInSlipID AS CMSPayInSlipID,p.DepositAccountNumber AS DepositAccountNumber,p.DepositeBankName AS DepositeBankName,p.DepositAmount AS DepositAmount,p.PaymentStatus AS PaymentStatus,p.ProductGroup AS ProductGroup,p.MerchantReferenceNumber AS MerchantReferenceNumber,p.MID AS MID,p.BankTransactionId AS BankTransactionId,p.BankId AS BankId,p.Amount AS Amount,p.StatusCode AS StatusCode,p.CreatedDate AS CreatedDate,p.RRN AS RRN,p.AuthCode AS AuthCode,p.CardNumber AS CardNumber,p.CardType AS CardType,p.CardHolderName AS CardHolderName,p.MerchantId AS MerchantId,p.MerchantTransactionId AS MerchantTransactionId,p.BBPayPartnerAgentCode AS BBPayPartnerAgentCode,p.BBPayPartnerAgentEmailId AS BBPayPartnerAgentEmailId,p.BBPayPartnerAgentMobileNumber AS BBPayPartnerAgentMobileNumber,p.BBPayPartnerBranchCode AS BBPayPartnerBranchCode,p.BBPayBatchAckDate AS BBPayBatchAckDate,p.CITY AS CITY,p.AckingAgent AS AckingAgent,p.PayInSlipDepositBankName AS PayInSlipDepositBankName,cast(p.BOMBucket as char charset utf8mb4) AS BOMBucket,p.NPA_STAGEID AS NPA_STAGEID,p.Region AS Region,p.AGREEMENTID AS AGREEMENTID,p.CURRENT_POS AS CURRENT_POS,p.lastmodifieddate AS lastmodifieddate from paymentcte p where (1 = 1) order by p.ReceiptDate desc